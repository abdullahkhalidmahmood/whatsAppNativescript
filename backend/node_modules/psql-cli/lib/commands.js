'use strict';

const commands = {
  '\\q': { quit: true },
  '\\d': (tablename) => {
    let cmd = ```
      SELECT n.nspname as "Schema",
        c.relname as "Name",
        CASE c.relkind WHEN 'r' THEN 'table' WHEN 'v' THEN 'view' WHEN 'm' THEN 'materialized view' WHEN 'i' THEN 'index' WHEN 'S' THEN 'sequence' WHEN 's' THEN 'special' WHEN 'f' THEN 'foreign table' WHEN 'p' THEN 'table' WHEN 'I' THEN 'index' END as "Type",
        pg_catalog.pg_get_userbyid(c.relowner) as "Owner"
      FROM pg_catalog.pg_class c
           LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
      WHERE c.relkind IN ('r','p','v','m','S','f','')
            AND n.nspname <> 'pg_catalog'
            AND n.nspname <> 'information_schema'
            AND n.nspname !~ '^pg_toast'
        AND pg_catalog.pg_table_is_visible(c.oid)
      ORDER BY 1,2;
    ```;
  },
};

const isCommand = (text) => {
  const [cmd] = text.split(' ');
  const action = commands[cmd];
  return action;
};

const runCommand = async (text, client) => {
  const [cmd, ...params] = text.split(' ');
  const action = commands[cmd];
  if (action.quit) {
    process.exit();
  }
  return [];
};

module.exports = { isCommand, runCommand };
